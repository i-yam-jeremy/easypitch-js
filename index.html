<html>
	<head>
		<title>EasyPitch.js Demo</title>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js?lang=js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">

		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.12/handlebars.min.js"></script>

		<script id="code-example-template" type="text/x-handlebars-template">
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-8">
					<h3 style="display: inline-block;">{{title}}</h3>
					<input id="code-example-button-{{name}}" style="display: inline-block; margin: 0.3rem" type="button" class="btn btn-primary" value="&#x25b6;"/>
					<pre class="prettyprint">
{{code}}
					</pre>
				</div>
				<div class="col-md-2"></div>
			</div>
		</script>

		<script src="easypitch.js"></script>
		<script type="text/javascript">
			const Instrument = EasyPitch.Instrument,
				SimpleInstrument = EasyPitch.SimpleInstrument,
				Note = EasyPitch.Note,
				Rest = EasyPitch.Rest;

			const CODE_EXAMPLES = [
				{name: "sine-wave", title: "Sine Wave", run: () => {	
					let inst = new SimpleInstrument([1], SimpleInstrument.WAVES.SINE);
					inst.playNotes([
						new Note("A", 4, 1/2),
						new Rest(1/4),
						new Note("A", 5, 1/2)
					], 60, () => {});
				}},
				
			];

			function removeClosureWrapping(s) {
				let newLineIndex = s.indexOf("\n") + 1;
				s = s.substring(newLineIndex, s.length-1); // cutoff the end '}'
				return s;
			}

			function correctIndentation(s) {
				let lines = s.split("\n");
				let index = 0;
				while (lines[0][index] == "\t") {
					index++;
				}
				lines = lines.map(line => line.substring(index));
				return lines.join("\n");
			}

			$(document).ready(() => {
				let templateSource = $("#code-example-template").html();
				let codeExampleTemplate = Handlebars.compile(templateSource);
				let examplesDiv = $("#examples");
				for (let example of CODE_EXAMPLES) {
					example.code = correctIndentation(removeClosureWrapping(example.run.toString()));
					examplesDiv.append(codeExampleTemplate(example));
					$("#code-example-button-" + example.name).click(example.run);
				}
				PR.prettyPrint();
			});

			function play() {
				let inst = new SimpleInstrument([1, 0, 0, 1/4], SimpleInstrument.WAVES.SQUARE);
				inst.playNotes([
					new Note("A", 4, 1/4),
					new Rest(1/4),
					new Rest(1/2),
					new Rest(1/4),
					new Note("E", 4, 1/4),
					new Rest(1/4),
					new Note("D", 4, 1/4),
					new Rest(1/4),
					new Note("Db", 4, 1),
					new Rest(1/2),
					new Note("Db", 4, 1/4),
					new Rest(1/4),
					new Note("D", 4, 1/4),
					new Rest(1/4),
					new Note("E", 4, 1/4),
					new Rest(1/4),
					new Note("F#", 4, 1/4),
					new Rest(1/4),
					new Note("Ab", 4, 1/4),
					new Rest(1/4),
					new Note("E", 4, 1),
					new Rest(1/4),
					new Note("F#", 4, 1/4),
					new Rest(1/4),
					new Rest(1/4),
					new Note("E", 4, 1/4),
					new Rest(1/4),
					new Note("D", 4, 1/4),
					new Rest(1/4),
					new Note("Db", 4, 1/4),
					new Rest(1/2),
					new Note("Db", 4, 1/4),
					new Rest(1/2),
					new Note("B", 3, 1/4),
					new Rest(1/2),
					new Note("Db", 4, 1/4),
					new Rest(1/2),
					new Note("D", 4, 1),
				],
				200, () => { console.log("Done"); });
			}
		</script>
	</head>
	<body>
		<div id="examples">
		</div>
	</body>
</html>
